# 澳洲家具独立站 - 技术设计方案

## 1. 项目概述

**目标**: 1:1 像素级复刻 McPhails.com.au，单人全栈开发，1个月交付

**技术选型**:
- 前端: Nuxt 4 + Element Plus
- 后端: Medusa v2
- 数据库: PostgreSQL + Redis
- 图片存储: 腾讯云OSS (COS)

---

## 2. 技术架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                         用户浏览器 (澳洲)                         │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    腾讯云新加坡服务器 (2核8G)                      │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  Nginx反向代理 (SSL终止, 静态资源缓存)                     │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              │                                   │
│  ┌──────────────────┐  ┌──────────────────────────────────┐   │
│  │  Nuxt 4 前端     │  │  Medusa v2 后端 API                │   │
│  │  - SSR渲染       │  │  - 模块化架构 (Modules)            │   │
│  │  - Element Plus  │  │  - 工作流引擎 (Workflows)          │   │
│  │  - Pinia状态     │  │  - 商品/订单管理                   │   │
│  └──────────────────┘  └──────────────────────────────────┘   │
│                              │                                   │
│  ┌──────────────────┐  ┌──────────────────────────────────┐   │
│  │  PostgreSQL      │  │  Redis 缓存                       │   │
│  └──────────────────┘  └──────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      腾讯云对象存储 (OSS)                         │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                           外部服务                                │
│  - SendGrid (邮件) - Stripe (支付) - Google OAuth               │
└─────────────────────────────────────────────────────────────────┘
```

---

## 3. 技术栈

### 3.1 前端

| 技术 | 版本 | 用途 |
|------|------|------|
| Nuxt 4 | ^4.3 | SSR框架 |
| Vue 3 | ^3.5 | 前端框架 |
| Element Plus | ^2.13 | UI组件库 |
| Pinia | ^3.0 | 状态管理 |
| @nuxt/image | ^2.0 | 图片优化 |

### 3.2 后端

| 技术 | 版本 | 用途 |
|------|------|------|
| Medusa | v2.x | 电商后端 |
| PostgreSQL | 15 | 主数据库 |
| Redis | 7.2 | 缓存 |
| Node.js | 22.16.0 | 运行时 |

**v2 核心模块**:
- `@medusjs/payment-stripe`: Stripe支付
- `@medusjs/file`: 文件存储 (扩展腾讯云OSS)
- 自定义Shipping Module: 澳洲运费规则

### 3.3 基础设施

| 服务 | 配置 | 费用 |
|------|------|------|
| 腾讯云CVM | 2核8G, 新加坡 | 1,100元/年 |
| 腾讯云OSS | 200GB + 20GB流量 | 500元/年 |
| SendGrid | Basic计划 | 500元/年 |
| 域名+SSL | - | 200元/年 |
| **总计** | | **2,300元/年** |

---

## 4. 核心功能方案

| 功能 | 技术方案 |
|------|----------|
| 巨型导航 (Mega Menu) | Element Plus `el-sub-menu` + 网格布局 |
| 多规格沙发展示 (PDP) | Medusa Variant API + 响应式主图切换 |
| 滑出式购物车 | Element Plus `el-drawer` + Pinia |
| 澳洲运费规则 | 自定义Shipping Module (偏远地区邮编拦截) |
| GST含税价 | 后端价格含税，前端标注"含GST" |
| 图片懒加载 | Nuxt Image + OSS CDN |
| 支付集成 | Stripe + Afterpay/Zip |

---

## 5. 数据库设计

### 5.1 Medusa v2 核心表 (自动创建)

- `product`, `product_variant`, `product_option`
- `cart`, `cart_item`
- `order`, `order_item`
- Links 表 (v2新架构)

### 5.2 扩展表 (澳洲本地化)

```sql
-- 澳洲邮编映射
CREATE TABLE au_postcode_mapping (
  postcode VARCHAR(10) PRIMARY KEY,
  state VARCHAR(3),
  is_remote BOOLEAN DEFAULT false,
  shipping_rate DECIMAL(10,2) DEFAULT 59.00
);
```

---

## 6. 部署架构

### 6.1 PM2 配置

```javascript
module.exports = {
  apps: [
    { name: 'medusa', script: 'node', args: './node_modules/.bin/medusa start' },
    { name: 'nuxt', script: 'node', args: './.output/server/index.mjs' }
  ]
}
```

### 6.2 Nginx 配置要点

- `/` → Nuxt前端 (端口3001)
- `/store/`, `/admin/` → Medusa API (端口9000)
- `/images/` → OSS CDN代理

---

## 7. 开发排期 (4周)

| 周次 | 任务 |
|------|------|
| W1 | 项目搭建 + Nuxt 4 + Medusa 配置 |
| W2 | 商品展示 + 导航系统 |
| W3 | 购物流程 + 运费计算 |
| W4 | 支付集成 + 测试上线 |

---

## 8. 风险与应对

| 风险 | 应对策略 |
|------|----------|
| Medusa v2生态尚不成熟 | 使用官方模块 + 自定义扩展 |
| 1个月工期紧张 | 严格执行MVP |
| 澳洲运费规则复杂 | 完整邮编数据库 + 单元测试 |

---

## 9. Medusa v2 关键变化

| v1 | v2 | 说明 |
|-----|-----|------|
| Plugin | Module | 模块化架构 |
| Service | Workflow | 工作流引擎 |
| Subscriber | Event | 事件系统 |

---

## 10. 项目结构

```
furnishing_e-commerce/
├── backend/              # Medusa v2 后端
│   ├── src/
│   │   ├── modules/     # 自定义模块
│   │   ├── workflows/   # 工作流
│   │   ├── api/         # API路由
│   │   └── links/       # 模块链接
│   └── medusa-config.ts
├── storefront/           # Nuxt 4 前端
├── docs/                 # 文档
└── docker-compose.yml
```
